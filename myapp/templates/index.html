{% extends "page.html" %}

{% block content %}
<div class="container mt-5">
    {% if has_sheet %}
    <div class="text-center p-5 rounded shadow bg-light">
        <h1 class="text-gradient fw-bold mb-3">ğŸ“ Welcome, {{ college.name }}!</h1>
        <p class="text-muted fs-5">Start by uploading student data via a Google Sheet or Excel file.</p>
        <p class="text-success fs-6">âœ¨ Itâ€™s fast, easy, and only takes a few minutes!</p>
        <p class="text-danger fw-semibold">ğŸ“¥ Upload your student list to proceed.</p>
        <a href="{% url 'student_list' %}" class="btn btn-gradient-primary btn-lg mt-3">
            <i class="fas fa-upload me-2"></i> Add Google Sheet or Excel File
        </a>
    </div>

    {% else %}
    <div class="text-center mt-4">
        <div class="d-flex flex-wrap justify-content-center gap-3 mb-4">

            <a class="btn btn-gradient-success btn-lg shadow-sm" href="{% url 'generate_poster' %}" data-loader>
                ğŸš€ Generate Poster
            </a>
            
            <a class="btn btn-gradient-secondary btn-lg shadow-sm" href="{% url 'download_poster_pdf' %}" data-loader>
                ğŸ“¥ Download Poster
            </a>
            

            <button class="btn btn-gradient-danger btn-lg shadow-sm" data-bs-toggle="modal" data-bs-target="#deletePosterModal">
                ğŸ—‘ï¸ Delete Poster
            </button>

            <button class="btn btn-gradient-info btn-lg shadow-sm" data-bs-toggle="modal" data-bs-target="#previewPosterModal">
                ğŸ‘ï¸ Preview Poster
            </button>
            {% endif %}
        </div>
    </div>

  <!-- Poster Preview Modal -->
<div class="modal fade" id="previewPosterModal" tabindex="-1" aria-labelledby="previewPosterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content shadow-lg border-0 rounded-4 overflow-hidden">
  
        <!-- Modal Header -->
        <div class="modal-header bg-gradient text-white py-3 px-4" style="background: linear-gradient(135deg, #007bff, #6610f2);">
          <h5 class="modal-title fw-bold" id="previewPosterModalLabel">
            ğŸ“„ Poster Preview
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
  
        <!-- Modal Body -->
        <div class="modal-body bg-light p-0">
          {% if is_have_sheet %}
          <!-- PDF Preview -->
          <iframe id="poster-preview" 
                  src="{% url 'download_poster' %}" 
                  class="w-100 border-0" 
                  style="height: 80vh; border-radius: 0 0 1rem 1rem;"></iframe>
          {% else %}
          <!-- No Poster Fallback -->
          <div class="d-flex flex-column justify-content-center align-items-center text-center p-5" style="height: 80vh;">
            <i class="fas fa-file-pdf fa-5x text-danger mb-4 bounce"></i>
            <h3 class="text-muted">No Poster Found</h3>
            <p class="text-secondary">
              Please upload student data and generate a poster to preview it here.
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  

    <!-- Delete Poster Modal -->
    <div class="modal fade" id="deletePosterModal" tabindex="-1" aria-labelledby="deletePosterModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-danger">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">âš ï¸ Confirm Delete</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this poster? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <form method="post" action="{% url 'delete_poster' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Yes, Delete</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
<div id="loader-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,0.8); z-index: 9999; justify-content: center; align-items: center;">
    <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<!-- Bootstrap & Font Awesome -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<!-- Custom Styles -->

    <style>
  .modal-content {
    border-radius: 1rem;
  }

  .bounce {
    animation: bounce 1.5s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  #poster-preview {
    transition: box-shadow 0.3s ease-in-out;
  }

  #poster-preview:hover {
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
  }

    .text-gradient {
        background: linear-gradient(to right, #0d6efd, #6610f2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .btn-gradient-primary {
        background: linear-gradient(45deg, #0d6efd, #6610f2);
        color: white;
        border: none;
    }

    .btn-gradient-secondary {
        background: linear-gradient(45deg, #6c757d, #adb5bd);
        color: white;
        border: none;
    }

    .btn-gradient-success {
        background: linear-gradient(45deg, #198754, #28a745);
        color: white;
        border: none;
    }

    .btn-gradient-danger {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
        border: none;
    }

    .btn-gradient-info {
        background: linear-gradient(45deg, #0dcaf0, #0b7dda);
        color: white;
        border: none;
    }

    .btn-gradient-primary:hover,
    .btn-gradient-secondary:hover,
    .btn-gradient-success:hover,
    .btn-gradient-danger:hover,
    .btn-gradient-info:hover {
        filter: brightness(1.05);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .pdf-iframe {
        border: 1px solid #dee2e6;
        border-radius: 8px;
    }

    .modal-content {
        border-radius: 12px;
        overflow: hidden;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const loader = document.getElementById('loader-overlay');
  
      document.querySelectorAll('a[data-loader]').forEach(btn => {
        btn.addEventListener('click', function (e) {
          loader.style.display = 'flex';
        });
      });
    });
  </script>
  
{% endblock %}
